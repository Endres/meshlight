{% extends "bootstrap/base.html" %}
{%- block styles %}
    <link href="{{url_for('.static', filename='bootstrap.min.css')}}" rel="stylesheet">
    <style>
      ul.circle {
        display: block;
        width: 400px;
        height: 400px;
        margin: 0 auto;
        list-style-type: none;
        padding: 32px;
      }

      ul.circle li {
        -moz-border-radius: 100px;
        -webkit-border-radius: 100px;
        background-color: #000;
        color: rgba(128, 128, 128, 0.5);
        position: absolute;
        margin: 0;
        height: 64px;
        width: 64px;
        text-align: center;
        font-size: 2.7em;
      }
    </style>
{%- endblock styles %}
{% block scripts %}
{{super()}}
<script type="text/javascript">
  function drawCircle(selector) {
    var total = $(selector).length;
    var alpha = Math.PI * 2 / total;
    var angle = -90;
    angle *= Math.PI / 180;
    var radius = $(selector).parent().width() / 2;

    $(selector).each(function(index) {
      var theta = alpha * index;
      var pointx  =  Math.floor(Math.cos( theta + angle ) * radius) + radius;
      var pointy  = Math.floor(Math.sin( theta + angle ) * radius) + radius;

      $(this).css("margin-left", pointx - $(selector).width()/2 + "px");
      $(this).css("margin-top", pointy - $(selector).height()/2 + "px");
    });
  }
</script>
<script type="text/javascript">
  var circleLength = 0;

  function updateCircles(newLength) {
    while (newLength > circleLength) {
      circleLength += 1;
      $("ul.circle").append($("<li></li>").text(circleLength));
      drawCircle("ul.circle li");
    }
    while (newLength < circleLength) {
      circleLength -= 1;
      $("ul.circle li").last().remove();
      drawCircle("ul.circle li");
    }
  }

  $("input#button1").click(function() {
    alert("bup");
  });

  function updateData() {
    $.get("/api/get_data").done(function(response) {
      $("#fps").text(response["fps"]);
      updateCircles(response["pixel_count"]);
      var count = Math.min(response["color_data"].length / 3, $("ul.circle li").length);
      for(var i = 0; i < count; i++) {
        $("ul.circle li").eq(i).text(i + 1);
        var r = response["color_data"][i * 3];
        var g = response["color_data"][i * 3 + 1];
        var b = response["color_data"][i * 3 + 2];
        $("ul.circle li").eq(i).css("backgroundColor", "rgb(" + r + "," + g + "," + b + ")");
      }
      setTimeout("updateData();", 50);
    }).error(function() {
      $("ul.circle li").text("?");
      setTimeout("updateData();", 1000);
    });
  }

  $(document).ready(function() {
    drawCircle("ul.circle li");
    updateData();
  });
</script>
{% endblock scripts %}
{% block navbar %}
    <nav class="navbar navbar-light bg-light">
      <a class="navbar-brand" href="#">MeshLight Server v1.0</a>
    </nav>
{% endblock navbar %}
{% block content %}
    <main role="main" class="container">
      <div id="fps">
        {{ fps }}
      </div>
      <input id="button1" type="button" value="Button!" class="btn btn-primary">
      <div>
        <ul class="circle">
        </ul>
      </div>
    </main>
{% endblock %}
